<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>Archives: 2019 | Private Zone</title>
  
  <meta name="keywords" content="web">
  
  

  

  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css">
  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.5/css/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  
  <div class="cover-wrapper">
    <cover class="cover  half">
      
        
  <h1 class="title">Private Zone</h1>


  <div class="m_search">
    <form name="searchform" class="form u-search-form">
      <input type="text" class="input u-search-input" placeholder>
      <i class="icon fas fa-search fa-fw"></i>
    </form>
  </div>

<div class="menu navgation">
  <ul class="h-list">
    
      
        <li>
          <a class="nav home" href="/" id="home">
            <i class="fas fa-rss fa-fw"></i>&nbsp;博文
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/projects/" id="projects">
            <i class="fas fa-code-branch fa-fw"></i>&nbsp;项目
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/friends/" rel="nofollow" id="friends">
            <i class="fas fa-link fa-fw"></i>&nbsp;友链
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/archives/" rel="nofollow" id="archives">
            <i class="fas fa-archive fa-fw"></i>&nbsp;归档
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/about/" rel="nofollow" id="about">
            <i class="fas fa-info-circle fa-fw"></i>&nbsp;关于
          </a>
        </li>
      
    
  </ul>
</div>

      
    </cover>
    <header class="l_header pure">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="pure"></div>
  </div>

	<div class="wrapper">
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href="/">
        
          Private Zone
        
      </a>
			<div class="menu navgation">
				<ul class="h-list">
          
  					
  						<li>
								<a class="nav flat-box" href="/" id="home">
									<i class="fas fa-grin fa-fw"></i>&nbsp;示例
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/" rel="nofollow" id="categories">
									<i class="fas fa-folder-open fa-fw"></i>&nbsp;分类
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/tags/" rel="nofollow" id="tags">
									<i class="fas fa-hashtag fa-fw"></i>&nbsp;标签
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/archives/" rel="nofollow" id="archives">
									<i class="fas fa-archive fa-fw"></i>&nbsp;归档
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/dev/cocoa/" id="categoriesdevcocoa">
									<i class="fab fa-apple fa-fw"></i>&nbsp;Cocoa Dev
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/dev/" id="categoriesdev">
									<i class="fas fa-laptop-code fa-fw"></i>&nbsp;Dev
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/life/" rel="nofollow" id="categorieslife">
									<i class="fas fa-coffee fa-fw"></i>&nbsp;Life
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="搜索">
						<i class="icon fas fa-search fa-fw"></i>
					</form>
				</div>
			
			<ul class="switcher h-list">
				
					<li class="s-search"><a class="fas fa-search fa-fw" href="javascript:void(0)"></a></li>
				
				<li class="s-menu"><a class="fas fa-bars fa-fw" href="javascript:void(0)"></a></li>
			</ul>
		</div>

		<div class="nav-sub container container--flex">
			<a class="logo flat-box"></a>
			<ul class="switcher h-list">
				<li class="s-comment"><a class="flat-btn fas fa-comments fa-fw" href="javascript:void(0)"></a></li>
        
          <li class="s-toc"><a class="flat-btn fas fa-list fa-fw" href="javascript:void(0)"></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/friends/" rel="nofollow" id="friends">
								<i class="fas fa-link fa-fw"></i>&nbsp;我的友链
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="https://xaoxuu.com/wiki/material-x/" rel="nofollow" id="https:xaoxuu.comwikimaterial-x">
								<i class="fas fa-book fa-fw"></i>&nbsp;主题文档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/about/" rel="nofollow" id="about">
								<i class="fas fa-info-circle fa-fw"></i>&nbsp;关于小站
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/" id="home">
								<i class="fas fa-clock fa-fw"></i>&nbsp;近期文章
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/archives/" rel="nofollow" id="archives">
								<i class="fas fa-archive fa-fw"></i>&nbsp;文章归档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/projects/" id="projects">
								<i class="fas fa-code-branch fa-fw"></i>&nbsp;开源项目
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/music/" rel="nofollow" id="music">
								<i class="fas fa-compact-disc fa-fw"></i>&nbsp;歌单分享
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>

  </div>


  <div class="l_body">
    <div class='body-wrapper'>
      <div class="l_main">
	
		
  <section class="post-list">
    
    
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2019/06/20/go-基础/">
      go基础整理
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>YY</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-06-20</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="1-go方法"><a href="#1-go方法" class="headerlink" title="1 go方法"></a>1 <strong><em>go方法</em></strong></h1><blockquote>
<ul>
<li>方法分为方法类型及方法值</li>
<li>方法类型：方法接收器的类型+方法名</li>
<li>方法值：方法接收器+方法名</li>
<li>方法类型及方法值均可以直接作为函数调用，方法类型函数调用时第一个参数为接收器类型，类型不会自动转换</li>
<li>方法值直接定义了接收器，接收器类型可自动转换，方法接收器的类型的实质不可以为指针或者interface；字面量取不到对应地址  </li>
</ul>
</blockquote>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line">type test struct&#123;</span><br><span class="line"><span class="selector-tag">a</span> int</span><br><span class="line"><span class="selector-tag">b</span> int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	fmt.Println(<span class="string">"Hello, playground"</span>)</span><br><span class="line">	<span class="selector-tag">b</span> := test&#123;<span class="number">2</span>,<span class="number">2</span>&#125;</span><br><span class="line">	<span class="selector-tag">b</span>.show(<span class="string">"直接调用"</span>)</span><br><span class="line">	<span class="comment">// 1 方法表达式</span></span><br><span class="line">	c := test<span class="selector-class">.show</span> <span class="comment">// 方法表达式</span></span><br><span class="line">	c(<span class="selector-tag">b</span>,<span class="string">"方法表达式调用"</span>) <span class="comment">// 调用方法表达式需要指定接收器</span></span><br><span class="line">	<span class="comment">// 2 方法的值</span></span><br><span class="line">	d := <span class="selector-tag">b</span><span class="selector-class">.show</span>  <span class="comment">// 或者(&amp;b).show 方法值调用自动指定接收器，类型可自动转换</span></span><br><span class="line">	d(<span class="string">"方法值调用方式"</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 方法指针</span></span><br><span class="line">	e := (*test)<span class="selector-class">.show1</span> <span class="comment">// 方法表达式 为指针</span></span><br><span class="line">	e(&amp;<span class="selector-tag">b</span>, <span class="string">"方法表达式调用"</span>) <span class="comment">// 接收器为指针，不会自动转换</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	f := (&amp;b)<span class="selector-class">.show1</span>  <span class="comment">// 或者b.show1</span></span><br><span class="line">	f(<span class="string">"方法值调用"</span>)</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (<span class="selector-tag">a</span> test) show(<span class="selector-tag">b</span> string)&#123;</span><br><span class="line">fmt.Printf(<span class="string">"%s: %+v\n"</span>,<span class="selector-tag">b</span>, a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 不可重名</span></span><br><span class="line">func (<span class="selector-tag">a</span> *test) show1(<span class="selector-tag">b</span> string)&#123;</span><br><span class="line"><span class="selector-tag">a</span>.a=<span class="number">1</span></span><br><span class="line">fmt.Printf(<span class="string">"%s: pointer %+v\n"</span>,<span class="selector-tag">b</span>, *a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-go接口"><a href="#2-go接口" class="headerlink" title="2 go接口"></a>2 go接口</h1><blockquote>
<ul>
<li>接口定义了规约</li>
<li>接口定义方法签名，interface{}类型为interface{}类型只是任意类型均实现了该接口，会隐士转换类型</li>
<li>接口值包括type&amp;&amp;value</li>
<li>接口为nil为接口值的type&amp;&amp;value均为nil</li>
<li>接口值的type类型必须实现接口对应的方法；go语言为静态语言，编译时无法知道接口的动态类型，？？？？接口的编译</li>
<li>接口初始化时会判定相应的初始化时是否实现了接口类型</li>
<li>接口的实现为指针时，接口初始化值不可以为变量必须为指针(go传参数为值copy类型)</li>
<li>接口的实现为值时，接口初始化可以为指针也可以为变量，指针可以隐士解引获取对应的底层变量</li>
<li><a href="https://draveness.me/golang/basic/golang-interface.html" target="_blank" rel="noopener"><strong><em>接口详细介绍及底层实现</em></strong></a></li>
<li>接口隐士实现：实现即接口</li>
<li>看代码：flag及sort的实现</li>
<li>示例：</li>
</ul>
</blockquote>
<blockquote>
<blockquote>
</blockquote>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">type</span> testInterface <span class="keyword">interface</span>&#123;</span><br><span class="line">set(a <span class="keyword">string</span>)</span><br><span class="line">show()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> testHello <span class="keyword">struct</span>&#123;</span><br><span class="line">info <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *testHello)</span> <span class="title">set</span><span class="params">(b <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">a.info=b</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *testHello)</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">fmt.Println(<span class="string">"here is: "</span>, a.info)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> hello testHello	</span><br><span class="line">	hello.info=<span class="string">"123"</span></span><br><span class="line">	<span class="keyword">var</span> testType testInterface = &amp;hello	<span class="comment">//接口类型为testInterface,接口值为动态变量的类型及值，接口的值分为type&amp;&amp;value</span></span><br><span class="line">						<span class="comment">//接口值： 1 type=*testHello 2 value=&amp;hello；接口值中type必须实现接口定义的方法</span></span><br><span class="line">						<span class="comment">// testInterface=hello错误</span></span><br><span class="line">					   	<span class="comment">//cannot use hello (type testHello) as type testInterface in assignment:</span></span><br><span class="line">					  	<span class="comment">//testHello does not implement testInterface (set method has pointer receiver)</span></span><br><span class="line">	testType.set(<span class="string">"hello world"</span>)</span><br><span class="line">	testType.show()</span><br><span class="line">	fmt.Printf(<span class="string">"%T"</span>,hello)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">type</span> testInterface <span class="keyword">interface</span>&#123;</span><br><span class="line">show()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> testHello <span class="keyword">struct</span>&#123;</span><br><span class="line">info <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a testHello)</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">fmt.Println(<span class="string">"here is: "</span>, a.info)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> hello testHello	</span><br><span class="line">	hello.info=<span class="string">"123"</span></span><br><span class="line">	<span class="keyword">var</span> testType testInterface = &amp;hello	<span class="comment">//接收类型为非指针类型，interface值的type可以为指针也可以为非指针</span></span><br><span class="line">	testType.show()</span><br><span class="line">	fmt.Printf(<span class="string">"%T"</span>,hello)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-1-反射"><a href="#2-1-反射" class="headerlink" title="2.1 反射"></a>2.1 反射</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resRaw为json byte,&#123;"code": , "data": , "message": &#125;</span></span><br><span class="line"><span class="comment">// 将[]byte解析为type res struct&#123;Code int, Message string, Data interface&#123;&#125;&#125;, json tag分别为code message data</span></span><br><span class="line"><span class="comment">// 兼容data为空及存在值时返回类型不同，data单独解析，首先判空</span></span><br><span class="line"><span class="comment">// resType struct&#123;Code int, Message string, Data []byte&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">parser</span><span class="params">(resRaw []<span class="keyword">byte</span>, res <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> resRaw == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> errors.New(<span class="string">"empty raw byte"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> resOri resType</span><br><span class="line">	<span class="keyword">if</span> err := json.Unmarshal(resRaw, &amp;resOri); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 获取res的类型及值，解析通常传指针 map []slice</span></span><br><span class="line">	t := reflect.TypeOf(res)</span><br><span class="line">	v := reflect.ValueOf(res)</span><br><span class="line">	<span class="comment">// 指针处理 获取实际类型的type及值</span></span><br><span class="line">	<span class="keyword">if</span> t.Kind() == reflect.Ptr &#123;</span><br><span class="line">		t = t.Elem()</span><br><span class="line">		v = v.Elem()</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 结构体</span></span><br><span class="line">	<span class="keyword">if</span> t.Kind() != reflect.Struct &#123;</span><br><span class="line">		log.Println(<span class="string">"Check type error not Struct"</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	members := t.NumField()</span><br><span class="line">	<span class="comment">// 处理方式1 fieldByName</span></span><br><span class="line">	<span class="comment">//v.FieldByName("Code").Set(reflect.ValueOf(resOri.Code))</span></span><br><span class="line">	<span class="comment">//v.FieldByName("Message").Set(reflect.ValueOf(resOri.Message))</span></span><br><span class="line">	<span class="comment">// 按照json Tag解析字串</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; members; i++ &#123;</span><br><span class="line">	<span class="comment">// 获取field tag json tag</span></span><br><span class="line">		<span class="keyword">switch</span> t.Field(i).Tag.Get(<span class="string">"json"</span>) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"data"</span>:</span><br><span class="line">			<span class="keyword">if</span> err := parseBody(resOri.Data, v.Field(i).Interface()); err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> err</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"code"</span>:</span><br><span class="line">			v.Field(i).Set(reflect.ValueOf(resOri.Code))</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"message"</span>:</span><br><span class="line">			v.Field(i).Set(reflect.ValueOf(resOri.Message))</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> err</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-Go工具"><a href="#3-Go工具" class="headerlink" title="3 Go工具"></a>3 Go工具</h1><h2 id="3-1-go-test"><a href="#3-1-go-test" class="headerlink" title="3.1 go test"></a>3.1 go test</h2><h2 id="3-2-go-mock-单测数据模拟"><a href="#3-2-go-mock-单测数据模拟" class="headerlink" title="3.2 go mock (单测数据模拟)"></a>3.2 go mock (单测数据模拟)</h2><p><strong><em>Links</em></strong><br><a href="https://www.jianshu.com/p/598a11bbdafb" target="_blank" rel="noopener">ref-1</a><br><a href="https://github.com/golang/mock" target="_blank" rel="noopener">github gomock</a></p>
<h1 id="4-Go内存管理"><a href="#4-Go内存管理" class="headerlink" title="4 Go内存管理"></a>4 Go内存管理</h1><h1 id="5-Go并发"><a href="#5-Go并发" class="headerlink" title="5 Go并发"></a>5 Go并发</h1><h2 id="5-1-Go-channel"><a href="#5-1-Go-channel" class="headerlink" title="5.1 Go channel"></a>5.1 Go channel</h2><blockquote>
<ul>
<li>类似消息队列</li>
<li>类似带同步一致性原语生产消费模式<br><a href="https://stackoverflow.com/questions/19621149/how-are-go-channels-implemented" target="_blank" rel="noopener">Go channel实现stackoverflow</a><br><a href="https://www.youtube.com/watch?reload=9&v=KBZlN0izeiY&feature=youtu.be" target="_blank" rel="noopener">youtube讲解go channel</a><br><a href="https://medium.com/a-journey-with-go/go-buffered-and-unbuffered-channels-29a107c00268" target="_blank" rel="noopener">go channel讲解</a></li>
</ul>
</blockquote>
<h2 id="5-2-调度模型-GODEBUG-schedtrace-1000-查看go-scheduler"><a href="#5-2-调度模型-GODEBUG-schedtrace-1000-查看go-scheduler" class="headerlink" title="5.2 调度模型:$GODEBUG=schedtrace=1000 查看go scheduler"></a>5.2 调度模型:$GODEBUG=schedtrace=1000 查看go scheduler</h2><blockquote>
<ul>
<li>两级线程模型(混合线程模型：用户线程:内核线程实现KSE=n:m)，即用户调度器实现用户线程到KSE的“调度”，内核调度器实现KSE到CPU上的调度。</li>
<li>Go运行时系统通过构造G-P-M对象模型实现了一套用户态的并发调度系统，可以自己管理和调度自己的并发任务，所以可以说Go语言原生支持并发。自己实现的调度器负责将并发任务分配到不同的内核线程上运行，然后内核调度器接管内核线程在CPU上的执行与调度。</li>
<li>抢占式调度：如果某个G没有进行system call调用、没有进行I/O操作、没有阻塞在一个channel操作上，那么m是通过抢占式调度让G停下来并调度下一个runnable G的<br>除非极端的无限循环或死循环，否则只要G调用函数，Go runtime就有抢占G的机会（每个函数入口）。Go程序启动时，runtime会去启动一个名为sysmon的m(一般称为监控线程)，该m无需绑定p即可运行，该m在整个Go程序的运行过程中至关重要：</li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li>问题：<br>1 P如何与M关联？<br>2 G如何与P关联？<br>3 P的设计意义？<br>4 如何处理G阻塞：channel netPool阻塞 vs 系统调用阻塞<br>5 netPool阻塞？<br>6 scheduler如何实现负载均衡、公平原则？<br>7 如何抢占式调度？<br>8 提升系统利用率</li>
</ul>
</blockquote>
</blockquote>
<h2 id="5-2-1-MG模型"><a href="#5-2-1-MG模型" class="headerlink" title="5.2.1 MG模型"></a>5.2.1 MG模型</h2><p>M代表OS线程<br>M创建完G必须保证另外一个M可以执行G(不是所有M都busy状态)<br>缺陷：</p>
<ol>
<li>sched全局锁，中心化共享数据多（需要注意互斥）goroutine相关所有操作（创建、完成、重新调度等）必须获取锁</li>
<li>工作线程不停在runnable的goroutine中流转(类似时间片)，导致时延及成本增加；每个M必须能够执行任意的G,尤其是M刚生成的G(减少上下文切换);Goroutine (G) hand-off (G.nextg).</li>
<li>大量资源占用，弱数据局部性(M保存了大量不需要运行的go code)：M线程具有内存缓存及栈空间，其应该用于running的go code，M在系统调用中阻塞不需要mcache；M的running go code与所有M’s比值高达1:100;Per-M memory cache (M.mcache). Memory cache and other caches (stack alloc) are associated with all M’s, while they need to be associated only with M’s running Go code (an M blocked inside of syscall does not need mcache). A ratio between M’s running Go code and all M’s can be as high as 1:100. This leads to excessive resource consumption (each MCache can suck up up to 2M) and poor data locality.</li>
<li>过多的线程阻塞太/运行态切换：工作线程系统调用的时候频繁堵塞非堵塞，增加成本；</li>
</ol>
<h2 id="5-2-2-MPG模型-将整个调度过程细粒度化提高性能"><a href="#5-2-2-MPG模型-将整个调度过程细粒度化提高性能" class="headerlink" title="5.2.2 MPG模型: 将整个调度过程细粒度化提高性能"></a>5.2.2 MPG模型: 将整个调度过程细粒度化提高性能</h2><p>The goal is to split the whole thing into minimal parts that can be independently reviewed and submitted.<br>work-stealing scheduler on top of processor<br>steal失败从全局idle G list获取G<br>GOMAXPROCS P’s 个P<br>G包含栈、context等，上下文切换为用户态<br>系统线程包括的东西较多，抽象出两线程模型，P层 G层占用较少资源，且M量的变化保证p不空闲游荡提升资源利用率；</p>
<ol>
<li>一些sched的变量，去中心化给到P</li>
<li>一些变量转移至p中管理，eg 运行go code需要的变量<br>所有的p在array中，GOMAXPROCS（P）数量的变化会stop the world扩展数组</li>
<li>增加P（processor）， P代表需要执行go code的资源</li>
<li>M阻塞时自旋，避免被操作系统切换阻塞太非堵塞太，尽量多占用cpu，造成cpu浪费</li>
<li>M开始执行go code时，从p数组中pop出p, M执行完go code将P入队， M只有在执行go code时必须有关联P；When an M is willing to start executing Go code, it must pop a P form the list. When an M ends executing Go code, it pushes the P to the list. So, when M executes Go code, it necessary has an associated P. This mechanism replaces sched.atomic (mcpu/mcpumax).</li>
<li>M进入系统调用时，保证存在另外一个M可以执行go code: There are two options, we can either promptly block and unblock M’s, or employ some spinning. 自旋在性能与cpu资源浪费之间存在矛盾；方案最终选择自旋：use spinning and do burn CPU cycles</li>
<li>M idle时spin，保证新建G时可以运行G（除非所有M busy）,提升新能：Spinning is two-level（M等待关联P, M+P寻找runnable G）: (1) an idle M with an associated P spins looking for new G’s, (2) an M w/o an associated P spins waiting for available P’s. There are at most GOMAXPROCS spinning M’s (both (1) and (2)). Idle M’s of type (1) do not block while there are idle M’s of type (2).<br>When a new G is spawned, or M enters syscall, or M transitions from idle to busy, it ensures that there is at least 1 spinning M (or all P’s are busy). This ensures that there are no runnable G’s that can be otherwise running; and avoids excessive M blocking/unblocking at the same time.<br>Spinning is mostly passive (yield to OS, sched_yield()), but may include a little bit of active spinning (loop burnging CPU) (requires investigation and tuning).</li>
<li>P空闲，M不足，则新建M保证P下可用G可以运行；</li>
<li>上下文切换为用户级</li>
<li>新建G，排队至P的runqueue中</li>
<li>P从自己的runqueue中pop G执行</li>
<li>M系统调用堵塞，M系统调用堵塞则系统线程级堵塞；P迁移至新的M（新建M或者从缓存池取）</li>
<li>P无可用G从global获取或者从其他P偷取</li>
<li>P定期从global中获取G，避免全局G饥饿</li>
</ol>
<p>调度：<br>1 新建可用G或者出现runnable G时，入队P的runnable list;<br>2 P执行完一个G，首先从自己的list pop G，若为空则选择P， steal half</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">Lock;</span><br><span class="line">G *gfree; <span class="comment">// freelist, moved from sched</span></span><br><span class="line">G *ghead; <span class="comment">// runnable, moved from sched</span></span><br><span class="line">G *gtail;</span><br><span class="line">MCache *mcache; <span class="comment">// moved from M</span></span><br><span class="line">FixAlloc *stackalloc; <span class="comment">// moved from M</span></span><br><span class="line">uint64 ncgocall;</span><br><span class="line">GCStats gcstats;</span><br><span class="line"><span class="comment">// etc</span></span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">P *allp; <span class="comment">// [GOMAXPROCS]</span></span><br><span class="line"></span><br><span class="line">There is also a lock-<span class="built_in">free</span> <span class="built_in">list</span> of idle P’s:</span><br><span class="line"></span><br><span class="line">P *idlep; <span class="comment">// lock-free list</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">The goal is to split the whole thing into minimal parts that can be independently reviewed and submitted.</span><br><span class="line">1. Introduce the P struct (empty for now); implement allp/idlep containers (idlep is mutex-protected for starters); associate a P <span class="keyword">with</span> M running <span class="keyword">Go</span> code. <span class="keyword">Global</span> <span class="keyword">mutex</span> <span class="keyword">and</span> atomic state <span class="keyword">is</span> still preserved.</span><br><span class="line"><span class="number">2.</span> <span class="keyword">Move</span> G <span class="keyword">freelist</span> <span class="keyword">to</span> P.</span><br><span class="line"><span class="number">3.</span> <span class="keyword">Move</span> mcache <span class="keyword">to</span> P.</span><br><span class="line"><span class="number">4.</span> <span class="keyword">Move</span> stackalloc <span class="keyword">to</span> P.</span><br><span class="line"><span class="number">5.</span> <span class="keyword">Move</span> ncgocall/gcstats <span class="keyword">to</span> P.</span><br><span class="line"><span class="number">6.</span> Decentralize run queue, implement <span class="keyword">work</span>-stealing. Eliminate G hand off. Still <span class="keyword">under</span> <span class="keyword">global</span> mutex.</span><br><span class="line"><span class="number">7.</span> Remove <span class="keyword">global</span> <span class="keyword">mutex</span>, implement <span class="keyword">distributed</span> termination detection, LockOSThread.</span><br><span class="line"><span class="number">8.</span> Implement spinning instead <span class="keyword">of</span> <span class="keyword">prompt</span> blocking/unblocking.</span><br><span class="line">The plan may turn <span class="keyword">out</span> <span class="keyword">to</span> <span class="keyword">not</span> <span class="keyword">work</span>, there <span class="keyword">are</span> a lot <span class="keyword">of</span> unexplored details.</span><br></pre></td></tr></table></figure>

<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Potential Further Improvements</span><br><span class="line">LIFO提高局部性避免饥饿保证一定公平性</span><br><span class="line">提升P的局部性，p运行曾经运行过的M</span><br><span class="line">限制M数量</span><br><span class="line"><span class="number">1.</span> Try out LIFO scheduling, this will improve locality. However, <span class="keyword">it</span> still must provide <span class="keyword">some</span> degree <span class="keyword">of</span> fairness <span class="keyword">and</span> gracefully handle yielding goroutines.</span><br><span class="line"><span class="number">2.</span> Do <span class="keyword">not</span> allocate G <span class="keyword">and</span> stack <span class="keyword">until</span> <span class="keyword">the</span> goroutine <span class="keyword">first</span> runs. For a newly created goroutine we need just callerpc, fn, narg, nret <span class="keyword">and</span> args, <span class="keyword">that</span> <span class="keyword">is</span>, <span class="keyword">about</span> <span class="number">6</span> <span class="built_in">words</span>. This will allow <span class="keyword">to</span> create a lot <span class="keyword">of</span> <span class="built_in">running</span>-<span class="keyword">to</span>-completion goroutines <span class="keyword">with</span> significantly lower memory overhead.</span><br><span class="line"><span class="number">4.</span> Better locality <span class="keyword">of</span> G-<span class="keyword">to</span>-P. Try <span class="keyword">to</span> enqueue an unblocked G <span class="keyword">to</span> a P <span class="keyword">on</span> which <span class="keyword">it</span> was <span class="keyword">last</span> <span class="built_in">running</span>.</span><br><span class="line"><span class="number">5.</span> Better locality <span class="keyword">of</span> P-<span class="keyword">to</span>-M. Try <span class="keyword">to</span> execute P <span class="keyword">on</span> <span class="keyword">the</span> same M <span class="keyword">it</span> was <span class="keyword">last</span> <span class="built_in">running</span>.</span><br><span class="line"><span class="number">6.</span> Throttling <span class="keyword">of</span> M creation. The scheduler can be easily forced <span class="keyword">to</span> create thousands <span class="keyword">of</span> M's per <span class="keyword">second</span> <span class="keyword">until</span> OS refuses <span class="keyword">to</span> create more threads. M’s must be created promptly up <span class="keyword">to</span> k*GOMAXPROCS, <span class="keyword">after</span> <span class="keyword">that</span> new M’s may added <span class="keyword">by</span> a timer.</span><br></pre></td></tr></table></figure>

<p><a href="https://docs.google.com/document/d/1TTj4T2JO42uD5ID9e89oa0sLKhJYD0Y_kqxDv3I3XMw/edit#" target="_blank" rel="noopener">MG模型变更MPG模型官方文档</a></p>
<p><a href="https://juejin.im/entry/59dc7bff6fb9a04500020217" target="_blank" rel="noopener">go并发模型掘金</a><br><a href="https://www.cnblogs.com/wdliu/p/9272220.html" target="_blank" rel="noopener">go调度&amp;channel</a><br><a href="https://tonybai.com/2017/06/23/an-intro-about-goroutine-scheduler/" target="_blank" rel="noopener">go routine调度器</a><br><a href="http://morsmachine.dk/go-scheduler" target="_blank" rel="noopener">go官方post MPG模型</a></p>
<h2 id="5-2-3-测试go-routine调度"><a href="#5-2-3-测试go-routine调度" class="headerlink" title="5.2.3 测试go routine调度"></a>5.2.3 测试go routine调度</h2><blockquote>
<ul>
<li>M+G运行中的G可以新建G，某种意义G是由M创建</li>
<li>单个P，G的队列顺序（FIFO），G的执行先后顺序？M+G堵塞（系统调用堵塞 channel堵塞？）是否新建M？回复堵塞G放置在全局队列？时间片？是否有抢占式？</li>
</ul>
</blockquote>
<h2 id="5-2-4-源码剖析"><a href="#5-2-4-源码剖析" class="headerlink" title="5.2.4 源码剖析"></a>5.2.4 源码剖析</h2><p>proc.go</p>
<h2 id="6-GO编程之道"><a href="#6-GO编程之道" class="headerlink" title="6 GO编程之道"></a>6 GO编程之道</h2><p><a href="https://tonybai.com/2017/04/20/go-coding-in-go-way/?hmsr=toutiao.io&utm_medium=toutiao.io&utm_source=toutiao.io" target="_blank" rel="noopener">go coding in go way</a></p>
<h2 id="7-Go调试-amp-性能调优"><a href="#7-Go调试-amp-性能调优" class="headerlink" title="7 Go调试&amp;性能调优"></a>7 Go调试&amp;性能调优</h2><p><a href="https://software.intel.com/en-us/blogs/2014/05/10/debugging-performance-issues-in-go-programs" target="_blank" rel="noopener">debugging</a></p>
<h2 id="8-压力测试"><a href="#8-压力测试" class="headerlink" title="8 压力测试"></a>8 压力测试</h2><p><a href="http://cwiki.guazi.com/pages/viewpage.action?pageId=89339717" target="_blank" rel="noopener">wiki压测工具</a></p>

      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/go/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>go</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2019/06/17/spring-boot/">
      springBoot整理
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>YY</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-06-17</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot "></a>SpringBoot </h1><ol>
<li>Issues</li>
</ol>
<hr>
<blockquote>
<ul>
<li><a href="https://www.jianshu.com/p/0c1d478d9759" target="_blank" rel="noopener"><strong>springboot正常启动访问404</strong></a> ：Springboot会自动扫描启动类同级包及其同级包的子包所有的注解。<br>如果想自己控制扫描哪些包的话，使用@componentscan注解，多个包的话使用逗号分隔<br>如：@componentscan(“com.package1,cn.package2”)</li>
</ul>
</blockquote>
<ol start="2">
<li>用法</li>
</ol>
<hr>
<blockquote>
<ul>
<li><a href="http://blog.didispace.com/springbootproperties/" target="_blank" rel="noopener">配置文件，参数配置,参数引用</a></li>
</ul>
</blockquote>
<blockquote>
<blockquote>
</blockquote>
<ul>
<li>变量配置:resource中配置两个文件application.properties &amp;&amp; application-dev.properties; 分配配置端口server.port为8081 &amp;&amp; 8088</li>
<li>java运行命令： java <strong><em>-Dspring.profiles.active=dev</em></strong> -jar target/XXXX.jar 或者 java -jar XX.jar <strong><em>–spring.profiles.active=dev</em></strong></li>
<li>实际运行端口为application-dev.properties文件中的配置</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>参数引用：通过@Value将私有变量value1定义为配置文件中com.test.rand对应值</li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<figure class="highlight plain"><figcaption><span>com.example.web;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.beans.factory.annotation.Value;  </span><br><span class="line">import org.springframework.web.bind.annotation.RestController;  </span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;  </span><br><span class="line">@RestController</span><br><span class="line">public class HelloController &#123;</span><br><span class="line">    @Value(&quot;$&#123;com.test.rand&#125;&quot;)</span><br><span class="line">    private String value1;</span><br><span class="line">    @RequestMapping(&quot;/hello&quot;)</span><br><span class="line">    public String index()&#123;</span><br><span class="line">        return value1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<ol start="3">
<li>spring DI</li>
</ol>
<hr>
<blockquote>
<ul>
<li>spring可以注入class注册到bean</li>
<li>spring bean可以由xml文件定义bean</li>
<li>应用程序支持spring注解需要配置app-context-annotation.xml文件,告诉spring扫描代码，找到@Component @Controller @Respository @Service注解的注入bean以及支持在指定包（及所有子包）下使用@Autowired @Inject @Resource注解的bean<br>xml文件配置可以被java配置替代(如下代码中的@Configuration) </li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app-context-annotation.xml文件:</span></span><br><span class="line">&lt;<span class="string">context:</span>componet-scan  </span><br><span class="line">base-<span class="keyword">package</span>=<span class="string">"com.apress.prospring5.ch3.annotation"</span>/&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li>app-context-xml.xml文件:</li>
</ul>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> &lt;bean <span class="attribute">id</span>=<span class="string">"provider"</span></span><br><span class="line"><span class="attribute">class</span>=....HelloWorldMessageProvider/&gt;</span><br><span class="line">&lt;bean <span class="attribute">id</span>=<span class="string">"renderer"</span></span><br><span class="line"><span class="attribute">class</span>=.....StandardOutMessageRenderer"</span><br><span class="line">p:<span class="attribute">messageProvider-ref</span>=<span class="string">"provider"</span>/&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<blockquote>
<ul>
<li>java配置</li>
</ul>
</blockquote>
<blockquote>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注解配置，ctx直接调用该配置，通过bean可以自动实现interface</span></span><br><span class="line"><span class="comment">// 该配置可以获取provider及renderer interface</span></span><br><span class="line"><span class="comment">// java配置可以同过xml文件注入eg: @ImportResource(locations = &#123;"classpath:spring/app-context-xml.xml"&#125;)</span></span><br><span class="line"><span class="keyword">@ComponentScan</span>(basePackages = &#123;<span class="string">"com.apress.prospring5.ch3.annotation) //必须启动组建扫描</span></span><br><span class="line"><span class="string">@Configuration</span></span><br><span class="line"><span class="string">public class HelloWorldConfiguration&#123;</span></span><br><span class="line"><span class="string">	@Bean</span></span><br><span class="line"><span class="string">	public MessageProvider provider() &#123;</span></span><br><span class="line"><span class="string">		return new HelloWorldMessageProvoder(); // provider具体实现class</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">	@Bean</span></span><br><span class="line"><span class="string">	public MessageRenderer renderer()&#123;</span></span><br><span class="line"><span class="string">		// renderer的具体实现class</span></span><br><span class="line"><span class="string">		MessageRenderer renderer = new StandardOutMessageRenderer(); </span></span><br><span class="line"><span class="string">		renderer.setMessageProvider(provider());</span></span><br><span class="line"><span class="string">		return renderer;</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">// 以上配置替代app-context-xml.xml文件: &lt;bean id="</span>provide<span class="string">r"</span></span><br><span class="line"><span class="string">class=....HelloWorldMessageProvider/&gt;</span></span><br><span class="line"><span class="string">&lt;bean id="</span>rendere<span class="string">r"</span></span><br><span class="line"><span class="string">class=.....StandardOutMessageRenderer"</span></span><br><span class="line">p:messageProvider-<span class="keyword">ref</span>=<span class="string">"provider"</span>/&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ul>
<li><strong><em>setter注入</em></strong><bean>中指定<property>标记（每个<property>标记注入一个依赖项）代码片段如下:</property></property></bean></li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">"renderer"</span></span><br><span class="line">	class=.....StandardOutMessageRendere<span class="string">r"&gt;</span></span><br><span class="line"><span class="string">	&lt;property name="</span>messageProvide<span class="string">r" ref="</span>provide<span class="string">r"/&gt;</span></span><br><span class="line"><span class="string">&lt;/bean&gt;</span></span><br><span class="line"><span class="string">&lt;bean id="</span>provide<span class="string">r"</span></span><br><span class="line"><span class="string">class=....HelloWorldMessageProvider/&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>spring2.5以上：</p>
</blockquote>
<blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> &lt;bean <span class="attribute">id</span>=<span class="string">"provider"</span></span><br><span class="line"><span class="attribute">class</span>=....HelloWorldMessageProvider/&gt;</span><br><span class="line">&lt;bean <span class="attribute">id</span>=<span class="string">"renderer"</span></span><br><span class="line"><span class="attribute">class</span>=.....StandardOutMessageRenderer"</span><br><span class="line">p:<span class="attribute">messageProvider-ref</span>=<span class="string">"provider"</span>/&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ul>
<li><strong><em>setter注入</em></strong>注解方式：</li>
</ul>
</blockquote>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(<span class="string">"renderer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StandardOutMessageRenderer</span> <span class="keyword">implements</span> <span class="title">MessageRenderer</span></span>&#123;</span><br><span class="line">	<span class="meta">@Overrider</span></span><br><span class="line">	<span class="meta">@Autowired</span> <span class="comment">//可使用@Resource(name="messageProvider")</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessageProvider</span><span class="params">(MessageProvoder provoder)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.messageProvider = provider;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ul>
<li><strong><em>构造函数注入</em></strong>  </li>
</ul>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigurableMessageProvider</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">MessageProvider</span></span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> message;</span><br><span class="line">	<span class="keyword">public</span> ConfigurableMessageProvider(<span class="keyword">String</span> message)&#123;</span><br><span class="line">		<span class="built_in">this</span>.message=message;</span><br><span class="line">	&#125;</span><br><span class="line">	@Overrider</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">String</span> getMessage()&#123;</span><br><span class="line">		<span class="keyword">return</span> message;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li>创建ConfigurableMessageProvider需要提供非null的消息值，重定义xml创建实例，使用构造函数注入消息:  </li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"messageProvider"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">....ConfigurableMessageProvider/</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructonr-arg</span> <span class="attr">type</span>=<span class="string">"String"</span> <span class="attr">value</span>=<span class="string">"I hope..."</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>多个构造函数使用index<br>Spring3.1起参数可以用c名称空间，即  </p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;constructonr-arg value=<span class="string">"I hope..."</span>/&gt;</span><br><span class="line">&lt;/<span class="keyword">bean&gt;</span></span><br><span class="line"><span class="keyword">修改为：c:message="I </span>I hope...<span class="string">"</span></span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<p>构造函数使用注解：</p>
<blockquote>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigurableMessageProvider</span> <span class="keyword">implements</span> <span class="title">MessageProvider</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String message;</span><br><span class="line">	<span class="comment">// @Value能注入值</span></span><br><span class="line">	<span class="meta">@AutoWired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ConfigurableMessageProvider</span><span class="params">(@Value(<span class="string">"configurable message"</span>)</span> String message)</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.message=message;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Overrider</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> message;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">将<span class="meta">@Value</span>变为外部文件注入</span><br><span class="line">xml文件变为：</span><br><span class="line">&lt;context:componet-scan  </span><br><span class="line">base-<span class="keyword">package</span>=<span class="string">"com.apress.prospring5.ch3.annotation"</span>/&gt;  </span><br><span class="line">&lt;bean id=<span class="string">"message"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"java.lang.String"</span></span><br><span class="line">	c:_0=<span class="string">"I hope ..."</span>/&gt;</span><br><span class="line">其中c:_0中_0为索引</span><br><span class="line">对应代码为：构造函数中value会由bean自动注入</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigurableMessageProvider</span> <span class="keyword">implements</span> <span class="title">MessageProvider</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String message;</span><br><span class="line">	<span class="comment">// @Value能注入值</span></span><br><span class="line">	<span class="meta">@AutoWired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ConfigurableMessageProvider</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.message=message;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Overrider</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> message;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>通过注解指定用于构造的构造方法: </p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> ConstructorConfusion()&#123;</span><br><span class="line"><span class="keyword">private</span> String somevalue</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> ConstructorConfusion(String somevalue)&#123;</span><br><span class="line">	System.<span class="keyword">out</span>.println(<span class="string">"ConstructorConfusion(string) called"</span>);</span><br><span class="line">	<span class="keyword">this</span>.somevalue=somevalue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@Autowired</span> <span class="comment">//指定了构造函数，只能用于一个</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> ConstructorConfusion(<span class="keyword">int</span> somevalue)&#123;</span><br><span class="line">	System.<span class="keyword">out</span>.println(<span class="string">"ConstructorConfusion(int) called"</span>);</span><br><span class="line">	<span class="keyword">this</span>.somevalue=<span class="string">"Number: "</span>+Integer.toString(somevalue);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String toString()&#123;</span><br><span class="line">	<span class="keyword">return</span> somevalue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String... args)&#123;</span><br><span class="line">GenericXmlApplicationContext ctx = <span class="keyword">new</span> GenericXmlApplicationContext();</span><br><span class="line">ctx.load(<span class="string">""c</span>lasspath:spring/app-context-annotation.xml<span class="string">");</span></span><br><span class="line"><span class="string">ctx.refresh();</span></span><br><span class="line"><span class="string">ConstructorConfusion cc=(ConstructorConfusion)ctx.getBean("c</span>onstructorConfusion<span class="string">");</span></span><br><span class="line"><span class="string">System.out.println(cc);</span></span><br><span class="line"><span class="string">ctx.close();</span></span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<blockquote>
<ul>
<li><strong><em>字段注入</em></strong>:依赖直接注入字段，不需要构造函数及setter,通过@Autowired<blockquote>
<p>不能用于final字段，只能通过构造函数  </p>
</blockquote>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>注入参数</li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li>setter与构造函数分别通过<property>及<constructor-args>标记注入<br>示例如下：</constructor-args></property></li>
</ul>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> class InjectSimple &#123;</span><br><span class="line">prviate <span class="built_in">String</span> name;</span><br><span class="line"><span class="keyword">private</span> int age;</span><br><span class="line"><span class="keyword">private</span> float height;</span><br><span class="line"><span class="keyword">public</span> static <span class="literal">void</span> main(<span class="built_in">String</span><span class="params">...</span> args)&#123;</span><br><span class="line">	GenericXmlApplicationContext ctx = <span class="literal">new</span> GenericXmlApplicationContext();</span><br><span class="line">ctx.load(<span class="string">""</span>classpath:spring/app<span class="params">-context</span><span class="params">-xml.xml</span><span class="string">");</span></span><br><span class="line"><span class="string">ctx.refresh();</span></span><br><span class="line"><span class="string">InjectSimple simple = (InjectSimple)ctx.getBean("</span>injectSimple<span class="string">");</span></span><br><span class="line"><span class="string">System.out.println(simple);</span></span><br><span class="line"><span class="string">ctx.close();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">public void setAge(String age)&#123;</span></span><br><span class="line"><span class="string">	this.age=age;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">public void setName(String name)&#123;</span></span><br><span class="line"><span class="string">	this.name=name;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">public void setHeight(float height)&#123;</span></span><br><span class="line"><span class="string">	this.height=height;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">app-context-xml.xml</span></span><br><span class="line"><span class="string">&lt;beans ...&gt;</span></span><br><span class="line"><span class="string">	&lt;bean id="</span>injectSimpleConfig<span class="string">"</span></span><br><span class="line"><span class="string">		class="</span>com.apress.prospring5.ch3.<span class="built_in">xml</span>.InjectSimpleConfig<span class="string">"/&gt;</span></span><br><span class="line"><span class="string">	&lt;bean id="</span>injectSimpleSpel<span class="string">" </span></span><br><span class="line"><span class="string">		class="</span>com.apress.prospring5.ch3.<span class="built_in">xml</span>.InjectSimpleSpel<span class="string">"</span></span><br><span class="line"><span class="string">		p:name="</span>xx<span class="string">"</span></span><br><span class="line"><span class="string">		p:age="</span><span class="number">123</span><span class="string">"</span></span><br><span class="line"><span class="string">		p:height="</span><span class="number">1.1</span><span class="string">"/&gt;</span></span><br><span class="line"><span class="string">&lt;/beans&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>注解方式:</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@Service</span>(<span class="string">"injectSimple"</span>) <span class="comment">//或者spel注入@Service("injectSimpleSpel")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> InjectSimple &#123;</span><br><span class="line"><span class="keyword">@Value</span>(<span class="string">"xx"</span>) <span class="comment">//或者spel注入 @Value("#&#123;injectSimpleConfig.name&#125;")</span></span><br><span class="line">prviate String name;</span><br><span class="line"><span class="keyword">@Value</span>(<span class="string">"11"</span>) <span class="comment">//或者spel注入 @Value("#&#123;injectSimpleConfig.age +1 &#125;")</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"><span class="keyword">@Value</span>(<span class="string">"1.1"</span>)</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">float</span> height;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String... args)&#123;</span><br><span class="line">	GenericXmlApplicationContext ctx = <span class="keyword">new</span> GenericXmlApplicationContext();</span><br><span class="line">ctx.load(<span class="string">""c</span>lasspath:spring/app-context-xml.xml<span class="string">");</span></span><br><span class="line"><span class="string">ctx.refresh();</span></span><br><span class="line"><span class="string">InjectSimple simple = (InjectSimple)ctx.getBean("</span>injectSimple<span class="string">");</span></span><br><span class="line"><span class="string">System.out.println(simple);</span></span><br><span class="line"><span class="string">ctx.close();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">public void setAge(String age)&#123;</span></span><br><span class="line"><span class="string">	this.age=age;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">public void setName(String name)&#123;</span></span><br><span class="line"><span class="string">	this.name=name;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">public void setHeight(float height)&#123;</span></span><br><span class="line"><span class="string">	this.height=height;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<blockquote>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/<span class="regexp">/调用方式：</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 1 xml文件配置</span></span><br><span class="line"><span class="regexp">publci class DeclareSpringComponents &#123;</span></span><br><span class="line"><span class="regexp">	GenericXmlApplicationContext ctx = new GenericXmlApplicationContext();</span></span><br><span class="line"><span class="regexp">	/</span><span class="regexp">/ A、加载app-context-annotation.xml文件 告知spring扫描代码找到注解,   </span></span><br><span class="line"><span class="regexp">		interface的具体实现class必须带注解;使用annotation包中注解定义的bean</span></span><br><span class="line"><span class="regexp">	/</span><span class="regexp">/ B、 加载app-context-xml.xml</span></span><br><span class="line"><span class="regexp">	ctx.load("classpath:spring/app</span>-context-xml.xml);<span class="regexp">//</span>可以将app-context-xml.xml  </span><br><span class="line">	替换为app-context-<span class="keyword">annotation</span>.<span class="title">xml</span>，只要<span class="title">class</span>的实现添加了注解，则两者实现完全一致</span><br><span class="line">	ctx.refresh();</span><br><span class="line">	MessageRenderer messageRenderer = ctx.getBean(<span class="string">"renderer"</span>, MessageRenderer.<span class="keyword">class</span>);</span><br><span class="line">		messageRenderer.render();</span><br><span class="line">	ctx.close();</span><br><span class="line">&#125;</span><br><span class="line">/<span class="regexp">/ 2 配置类</span></span><br><span class="line"><span class="regexp">public class HelloWorldAnnotated &#123;</span></span><br><span class="line"><span class="regexp">	public static void main(String... args) &#123;</span></span><br><span class="line"><span class="regexp">		/</span><span class="regexp">/ 加载配置类</span></span><br><span class="line"><span class="regexp">		ApplicationContext ctx = new AnnotationConfigApplicationContext(HelloWorldConfiguration.class);</span></span><br><span class="line"><span class="regexp">		MessageRenderer messageRenderer = ctx.getBean("renderer", MessageRenderer.class);</span></span><br><span class="line"><span class="regexp">		messageRenderer.render();</span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ul>
<li>spring框架主要：interface + DI (dependency injection)</li>
<li>通过applicationContext获取interface的具体实现class，通过ctx.getbean自动实现interface，spring 框架自动处理</li>
<li>setter注入，java 配置， 构造函数实现</li>
<li>java配置 </li>
</ul>
</blockquote>
<h1 id="10-参考查询"><a href="#10-参考查询" class="headerlink" title="10 参考查询"></a>10 参考查询</h1><p><a href="https://mp.weixin.qq.com/s/RsVGRXiYmTyyi5cTBrk_kg" target="_blank" rel="noopener">spring注解</a><br><fancybox><br><img src="../pic/java%E6%B3%A8%E8%A7%A3.png" alt="java spring注解"><br></fancybox></p>

      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/java-spring-boot/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>java, spring boot</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2019/06/14/java基础/">
      java基础整理
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>YY</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-06-14</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="java基础"><a href="#java基础" class="headerlink" title="java基础"></a>java基础</h1><ol>
<li><a href="https://blog.csdn.net/yaomingyang/article/details/79321939" target="_blank" rel="noopener"><strong>序列化</strong></a></li>
</ol>
<hr>
<blockquote>
<ul>
<li>将<strong><em>对象</em></strong>的状态信息转化为可以存储或者传输的形式的过程</li>
<li><strong><em>储存媒介</em></strong>档案、记忆缓冲体；网络传输中为：字节或者xml文件</li>
<li><strong><em>反序列化</em></strong>存储形式还原为对象</li>
<li>创建的对象在jvm的stack中，jvm停止对象消失，<strong><em>序列化</em></strong>持久对象需要的时候<strong><em>反序列化</em></strong>恢复</li>
<li>应用场景: RMI(远程方法调用)及网络传输</li>
<li>API接口：java.io.Serializable &amp;&amp; java.io.Externalizable</li>
<li>序列化时，并不保存静态变量: 序列化保存的是对象的状态，静态变量属于类的状态，因此序列化并不保存静态变量</li>
<li>Transient关键字: 控制变量的序列化，在变量声明前加上该关键字，可以阻止该变量被序列化到文件中，在被反序列化后，transient 变量的值被设为初始值</li>
<li>Externalizable继承了Serializable，该接口中定义了两个抽象方法：writeExternal()与readExternal()。当使用Externalizable接口来进行序列化与反序列化的时候需要开发人员重写writeExternal()与readExternal()方法。若不定义这两个方法的实现细节，则输出的内容为空。</li>
<li>在使用Externalizable进行序列化的时候，在读取对象时，会调用被序列化类的无参构造器去创建一个新的对象，然后再将被保存对象的字段的值分别填充到新对象中。所以，实现Externalizable接口的类必须要提供一个public的无参的构造器。</li>
</ul>
</blockquote>
<ol start="2">
<li><a href="https://blog.csdn.net/u012721013/article/details/53199854" target="_blank" rel="noopener"><strong>java编译&amp;&amp;运行</strong></a></li>
</ol>
<hr>
<blockquote>
<ul>
<li>javac将java程序编译成二进制字节码class</li>
<li>jvm虚拟机：加载class 编译成机器码(JIT编译时运行动态编译，AOT先编译后运行) 内存管理</li>
<li>java为跨平台语言，运行在jvm虚拟机上，虚拟机本身处理不同操作系统平台问题</li>
<li>JIT编译&amp;&amp;运行节省空间效率低，编译跟运行共分资源影响运行；</li>
<li>AOT编译完运行，占用空间，运行效率高</li>
</ul>
</blockquote>
<p><a href="https://blog.csdn.net/h1130189083/article/details/78302502" target="_blank" rel="noopener">JIT VS AOT</a><br><a href="https://blog.csdn.net/zhangjg_blog/article/details/20380971" target="_blank" rel="noopener">java虚拟机</a><br><a href="https://www.javatpoint.com/nested-interface" target="_blank" rel="noopener">java基础</a></p>
<ol start="3">
<li><a href="https://stackoverflow.com/questions/861422/is-the-java-virtual-machine-really-a-virtual-machine-in-the-same-sense-as-my-vmw" target="_blank" rel="noopener">jvm vs vmWare</a></li>
</ol>
<hr>
<blockquote>
<ul>
<li>jvm是虚拟进程：程序计数 内存管理 虚拟cpu</li>
<li>启动不同的java程序会启动不同的jvm进程</li>
<li>java程序依赖与jvm进程</li>
<li>vmWare为虚拟机器: 进程管理 i/o cpu 网络i/o</li>
<li>[vmWare vs docker] (<a href="https://stackoverflow.com/questions/16047306/how-is-docker-different-from-a-virtual-machine" target="_blank" rel="noopener">https://stackoverflow.com/questions/16047306/how-is-docker-different-from-a-virtual-machine</a>)</li>
<li>docker应用打包：资源隔离 应用打包 应用依赖 应用的环境变量等</li>
<li><a href="https://juejin.im/post/5b260ec26fb9a00e8e4b031a" target="_blank" rel="noopener">docker虚拟操作系统共享内核</a></li>
<li>容器虚拟化的是操作系统而不是硬件，容器之间是共享同一套操作系统资源的。虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统。因此容器的隔离级别会稍低一些。</li>
<li>docker  </li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<ol>
<li>Docker 是世界领先的软件容器平台。</li>
<li>Docker 使用 Google 公司推出的 Go 语言  进行开发实现，基于 Linux 内核 的cgroup，namespace，以及AUFS类的UnionFS等技术，<strong><em>对进程进行封装隔离</em></strong>，属于<strong><em>操作系统层面的虚拟化技术</em></strong>。 由于隔离的进程独立于宿主和其它的隔离的进程，因此也称其为容器。Docke最初实现是基于 LXC.</li>
<li>Docker 能够自动执行重复性任务，例如搭建和配置开发环境，从而解放了开发人员以便他们专注在真正重要的事情上：构建杰出的软件。</li>
<li>用户可以方便地创建和使用容器，把自己的应用放入容器。容器还可以进行版本管理、复制、分享、修改，就像管理普通的代码一样。</li>
</ol>
</blockquote>
</blockquote>
<ol start="4">
<li><a href="https://blog.csdn.net/briblue/article/details/73824058" target="_blank" rel="noopener">java注解&amp;&amp;反射</a></li>
</ol>
<blockquote>
<ul>
<li>注解类似标签不是程序，通过反射可以获取注解，obj.getclass 利用class获取类中成员 方法 类本身等的注解</li>
<li>注解可以定义期时间周期</li>
<li>反射获取类信息 方法等，方法可以通过invoke执行对应的方法</li>
<li><a href="https://blog.csdn.net/cuiran/article/details/5302074" target="_blank" rel="noopener">invoke示例</a></li>
<li>代码类似如下：</li>
</ul>
</blockquote>
<p><strong><em>主入口：</em></strong></p>
<figure class="highlight plain"><figcaption><span>tags.*;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import java.lang.annotation.Annotation;</span><br><span class="line">import java.lang.reflect.Constructor;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.lang.reflect.Modifier;</span><br><span class="line"></span><br><span class="line">@SuppressWarnings(&quot;deprecation&quot;)</span><br><span class="line">@TestAnnotation()</span><br><span class="line">public class MyAnnotation &#123;</span><br><span class="line"></span><br><span class="line">    @Check</span><br><span class="line">    int a;</span><br><span class="line">    @Perform</span><br><span class="line">    public void testMethod()&#123;&#125;;</span><br><span class="line">    @SuppressWarnings(&quot;deprecation&quot;)</span><br><span class="line">    public void test1()&#123;</span><br><span class="line">        Hero myHero = new Hero();</span><br><span class="line">        myHero.speak();</span><br><span class="line">        myHero.speak();</span><br><span class="line">        int b = a;</span><br><span class="line">        System.out.println(b);</span><br><span class="line">    &#125;</span><br><span class="line">    private int test2(int c, int d)&#123;</span><br><span class="line">        return c+d;</span><br><span class="line">    &#125;</span><br><span class="line">    public MyAnnotation(int ...b )&#123;</span><br><span class="line">        a=b[0];</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line"></span><br><span class="line">        boolean ifAnnotation = MyAnnotation.class.isAnnotationPresent(TestAnnotation.class);</span><br><span class="line">        if (ifAnnotation)&#123;</span><br><span class="line">            TestAnnotation testAnnotation = MyAnnotation.class.getAnnotation(TestAnnotation.class);</span><br><span class="line">            System.out.println(&quot;the id of annotation is: &quot;+testAnnotation.id());</span><br><span class="line">            System.out.println(&quot;the string of annnotaion is: &quot; + testAnnotation.msg());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        MyAnnotation myTest = new MyAnnotation(1,2);</span><br><span class="line">        Class myClass = myTest.getClass();</span><br><span class="line">        Field[] myFields = myClass.getDeclaredFields();</span><br><span class="line">        for (Field myField : myFields)&#123;</span><br><span class="line">            System.out.println(myField);</span><br><span class="line">        &#125;</span><br><span class="line">        Method[] methods = myClass.getDeclaredMethods();</span><br><span class="line">        // 示例method.invoke</span><br><span class="line">        // methodXX.invoke(Object obj, Object ...args)利用指定的参数args执行指定对象obj中该方法，返回值为object型</span><br><span class="line">        for (Method method : methods)&#123;</span><br><span class="line">            if (method.getName()==&quot;test2&quot;) &#123;</span><br><span class="line">                try &#123;System.out.println(&quot;res of invoke: &quot;+ method.invoke(myTest, new Object[] &#123;new Integer(10), new Integer(20)&#125;));</span><br><span class="line">                &#125;catch(Exception e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            Field a = MyAnnotation.class.getDeclaredField(&quot;a&quot;);</span><br><span class="line">            a.setAccessible(true);</span><br><span class="line">            Check check = a.getAnnotation(Check.class);</span><br><span class="line">            if (check != null) &#123;</span><br><span class="line">                System.out.println(check.value());</span><br><span class="line">            &#125;</span><br><span class="line">            Constructor[] test = MyAnnotation.class.getConstructors();</span><br><span class="line">            int modifiers = test[0].getModifiers();</span><br><span class="line">            System.out.println(Modifier.isPrivate(modifiers));</span><br><span class="line">            for (Constructor tets : test)&#123;</span><br><span class="line">                System.out.println(&quot;构造函数是否带参数: &quot;+ tets.isVarArgs());</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;catch (NoSuchFieldException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        &#125;catch (SecurityException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>package tags</em></strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tags;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Check &#123;</span><br><span class="line">	<span class="comment">//注解的属性 名为value类型为string默认值为"hi"</span></span><br><span class="line">    String value() <span class="keyword">default</span> <span class="string">"hi"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> tags;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hero</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Deprecated()</span></span><br><span class="line">    <span class="keyword">public</span> void say()&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"Noting has to say!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> void speak()&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"I have a dream!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> tags;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Perform &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> tags;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.<span class="keyword">annotation</span>.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.<span class="keyword">annotation</span>.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.<span class="keyword">annotation</span>.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.<span class="keyword">annotation</span>.Target;</span><br><span class="line"><span class="comment">//target为基本注解限定注解可以使用的范围</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="comment">// retention限定注解的生命周期</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> TestAnnotation &#123;</span><br><span class="line">    int id() <span class="keyword">default</span> <span class="number">1</span>;</span><br><span class="line">    String msg() <span class="keyword">default</span> <span class="string">"hi"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/java/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>java</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2019/06/14/go_mem/">
      go 内存
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>YY</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-06-13</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="go内存模型"><a href="#go内存模型" class="headerlink" title="go内存模型"></a>go内存模型</h1><ol>
<li><strong>内存模型剖析</strong></li>
</ol>
<hr>
<blockquote>
<ul>
<li>待补充</li>
</ul>
</blockquote>
<ol start="2">
<li><a href="https://www.jianshu.com/p/72e1a2571f01" target="_blank" rel="noopener"><strong>逃逸分析</strong></a></li>
</ol>
<hr>
<blockquote>
<ul>
<li>编译参数加入 -gcflags ‘-m -l’</li>
<li>go消除堆栈区别  </li>
<li>逃逸分析确定变量的储存区域为堆/栈，减少gc压力，栈可以直接回收，栈分配空间及回收空间较快</li>
<li>代码段</li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<figure class="highlight plain"><figcaption><span>main</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import (</span><br><span class="line">	&quot;time&quot;</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line">func main()&#123;</span><br><span class="line">	//go_parser.TestParser(&quot;a==1 &amp;&amp; b!=2&quot;)</span><br><span class="line">	res := make(map[string]int)</span><br><span class="line">	fmt.Println(res[&quot;res&quot;])</span><br><span class="line">	fmt.Println(int(time.Now().Weekday()))</span><br><span class="line">	// test grpc dispatch get scenes</span><br><span class="line">	//grpc.GetScene(20351, imkfdispatch.Scene_BuyCarConsult)</span><br><span class="line">	res1 := taoyi()</span><br><span class="line">	fmt.Println(&quot;2st addr of i: &quot;, res1)</span><br><span class="line">	i := *res1</span><br><span class="line">	fmt.Println(&quot;the res is: %d&quot;, i)</span><br><span class="line">	fmt.Println(&quot;3st addr of i: &quot;, &amp;i)</span><br><span class="line">&#125;</span><br><span class="line">func taoyi()(*int)&#123;</span><br><span class="line">	var i int = 1</span><br><span class="line">	fmt.Println(&quot;1st addr of i: &quot;, &amp;i)</span><br><span class="line">	return &amp;i</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<blockquote>
<ul>
<li>输出内容：</li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<p>./main.go:25:14: “1st addr of i: “ escapes to heap<br>./main.go:25:33: &amp;i escapes to heap<br>./main.go:25:33: &amp;i escapes to heap<br>./main.go:24:6: moved to heap: i<br>./main.go:26:9: &amp;i escapes to heap<br>./main.go:25:13: taoyi … argument does not escape<br>./main.go:11:17: res[“res”] escapes to heap<br>./main.go:13:17: int(time.Now().Weekday()) escapes to heap<br>./main.go:17:14: “2st addr of i: “ escapes to heap<br>./main.go:17:14: res1 escapes to heap<br>./main.go:19:14: “the res is: %d” escapes to heap<br>./main.go:19:14: i escapes to heap<br>./main.go:20:14: “3st addr of i: “ escapes to heap<br>./main.go:20:33: &amp;i escapes to heap<br>./main.go:20:33: &amp;i escapes to heap<br>./main.go:18:2: moved to heap: i<br>./main.go:10:13: main make(map[string]int) does not escape<br>./main.go:11:13: main … argument does not escape<br>./main.go:13:13: main … argument does not escape<br>./main.go:17:13: main … argument does not escape<br>./main.go:19:13: main … argument does not escape<br>./main.go:20:13: main … argument does not escape</p>
</blockquote>
</blockquote>
<p><a href="https://studygolang.com/articles/10026" target="_blank" rel="noopener">参考1</a></p>

      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/go-内存/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>go,内存</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2019/06/12/java-异常/">
      java异常处理
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>YY</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-06-11</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h2 id="1-自定义异常"><a href="#1-自定义异常" class="headerlink" title="1 自定义异常"></a>1 <a href="https://www.runoob.com/java/java-exceptions.html" target="_blank" rel="noopener">自定义异常</a></h2>
      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/java-异常/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>java, 异常</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
    
  </section>
  
    
      <br>
      <div class="prev-next">
        <div class="prev-next">
          
            <a class="prev" rel="prev" href="/archives/2019/">
              <section class="post prev">
                <i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;上一页&nbsp;
              </section>
            </a>
          
          <p class="current">
            2 / 2
          </p>
          
        </div>
      </div>

    
    <!-- 根据主题中的设置决定是否在archive中针对摘要部分的MathJax公式加载mathjax.js文件 -->
    
    

  


	
</div>
<aside class="l_side">
  
    
    
      
        
          
          
            <section class="widget author">
  <div class="content pure">
    
      <div class="avatar">
        <img class="avatar" src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@master/avatar/avatar.png">
      </div>
    
    
    
      <div class="social-wrapper">
        
          
            <a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="mailto:1204321942@qq.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://github.com/Beginner18" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://music.163.com/#/user/home?id=63035382" class="social fas fa-headphones-alt flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

          
        
      
        
          
          
            

          
        
      
        
          
          
            <section class="widget grid">
  
<header class="pure">
  <div><i class="fas fa-map-signs fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;站内导航</div>
  
</header>

  <div class="content pure">
    <ul class="grid navgation">
      
        <li><a class="flat-box" title="/" href="/" id="home">
          
            <i class="fas fa-clock fa-fw" aria-hidden="true"></i>
          
          近期文章
        </a></li>
      
        <li><a class="flat-box" title="/archives/" href="/archives/" rel="nofollow" id="archives">
          
            <i class="fas fa-archive fa-fw" aria-hidden="true"></i>
          
          文章归档
        </a></li>
      
        <li><a class="flat-box" title="/projects/" href="/projects/" id="projects">
          
            <i class="fas fa-code-branch fa-fw" aria-hidden="true"></i>
          
          开源项目
        </a></li>
      
        <li><a class="flat-box" title="/friends/" href="/friends/" rel="nofollow" id="friends">
          
            <i class="fas fa-link fa-fw" aria-hidden="true"></i>
          
          我的友链
        </a></li>
      
        <li><a class="flat-box" title="/" href="/" rel="nofollow" id="home">
          
            <i class="fas fa-book fa-fw" aria-hidden="true"></i>
          
          主题文档
        </a></li>
      
        <li><a class="flat-box" title="/about/" href="/about/" rel="nofollow" id="about">
          
            <i class="fas fa-info-circle fa-fw" aria-hidden="true"></i>
          
          关于小站
        </a></li>
      
    </ul>
  </div>
</section>

          
        
      
        
          
          
            
  <section class="widget category">
    
<header class="pure">
  <div><i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;文章分类</div>
  
    <a class="rightBtn" rel="nofollow" href="/categories/" title="categories/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class="content pure">
      <ul class="entry">
        
          <li><a class="flat-box" title="/categories/java/" href="/categories/java/"><div class="name">java</div><div class="badge">(1)</div></a></li>
        
          <li><a class="flat-box" title="/categories/网络/" href="/categories/网络/"><div class="name">网络</div><div class="badge">(1)</div></a></li>
        
          <li><a class="flat-box" title="/categories/网络框架/" href="/categories/网络框架/"><div class="name">网络框架</div><div class="badge">(1)</div></a></li>
        
      </ul>
    </div>
  </section>


          
        
      
        
          
          
            
  <section class="widget tagcloud">
    
<header class="pure">
  <div><i class="fas fa-fire fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;热门标签</div>
  
    <a class="rightBtn" rel="nofollow" href="/tags/" title="tags/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class="content pure">
      <a href="/tags/gin/" style="font-size: 14px; color: #999">gin</a> <a href="/tags/go/" style="font-size: 24px; color: #555">go</a> <a href="/tags/go-内存/" style="font-size: 14px; color: #999">go,内存</a> <a href="/tags/grpc/" style="font-size: 14px; color: #999">grpc</a> <a href="/tags/http/" style="font-size: 14px; color: #999">http</a> <a href="/tags/http1-0-2/" style="font-size: 14px; color: #999">http1.0-2</a> <a href="/tags/java/" style="font-size: 14px; color: #999">java</a> <a href="/tags/java-spring-boot/" style="font-size: 14px; color: #999">java, spring boot</a> <a href="/tags/java-异常/" style="font-size: 14px; color: #999">java, 异常</a> <a href="/tags/tcp-ip/" style="font-size: 14px; color: #999">tcp/ip</a> <a href="/tags/unix/" style="font-size: 14px; color: #999">unix</a> <a href="/tags/webSocket/" style="font-size: 14px; color: #999">webSocket</a> <a href="/tags/依赖管理/" style="font-size: 14px; color: #999">依赖管理</a> <a href="/tags/操作系统/" style="font-size: 14px; color: #999">操作系统</a> <a href="/tags/服务发现/" style="font-size: 14px; color: #999">服务发现</a> <a href="/tags/服务注册/" style="font-size: 14px; color: #999">服务注册</a> <a href="/tags/自动代理/" style="font-size: 14px; color: #999">自动代理</a>
    </div>
  </section>


          
        
      
        
          
          
            

          
        
      
        
          
          
            


  <section class="widget music">
    
<header class="pure">
  <div><i class="fas fa-compact-disc fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;最近在听</div>
  
    <a class="rightBtn" rel="external nofollow noopener noreferrer" target="_blank" href="https://music.163.com/#/user/home?id=63035382" title="https://music.163.com/#/user/home?id=63035382">
    <i class="far fa-heart fa-fw"></i></a>
  
</header>

    <div class="content pure">
      
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.css">
  <div class="aplayer" data-theme="#1BCDFC" data-mode="circulation" data-server="netease" data-type="playlist" data-id="2615636388" data-volume="0.7">
  </div>
  <script src="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/meting@1.1.0/dist/Meting.min.js"></script>


    </div>
  </section>


          
        
      
    

  
</aside>

<footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="mailto:1204321942@qq.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://github.com/Beginner18" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://music.163.com/#/user/home?id=63035382" class="social fas fa-headphones-alt flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
    </div>
  
  <br>
  <div><p>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
  <div>
    本站使用
    <a href="https://xaoxuu.com/wiki/material-x/" target="_blank" class="codename">Private Zone</a>
    作为主题
    
      ，
      总访问量为
      <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
      次
    
    。
  </div>
</footer>
<script>setLoadingBarProgress(80);</script>




	<!-- 根据主题中的设置决定是否在archive中针对摘要部分的MathJax公式加载mathjax.js文件 -->
	

	


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>

<script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>




  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        if ('.cover') {
          $('.cover').backstretch(
          ["https://img.vim-cn.com/6d/a0c9e6f9efad8b731cb7376504bd10d79d2053.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        } else {
          $.backstretch(
          ["https://img.vim-cn.com/6d/a0c9e6f9efad8b731cb7376504bd10d79d2053.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        }
      });
    </script>
  











  <script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.5/js/app.js"></script>


  <script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.5/js/search.js"></script>




<!-- 复制 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "复制成功";
  let COPY_FAILURE = "复制失败";
  /*页面载入完成后，创建复制按钮*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //您可以加入成功提示
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //您可以加入失败提示
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * 弹出式提示框，默认1.5秒自动消失
   * @param message 提示信息
   * @param style 提示样式，有alert-success、alert-danger、alert-warning、alert-info
   * @param time 消失时间
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // 成功提示
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // 失败提示
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // 提醒
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // 信息提示
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
</body>
</html>
